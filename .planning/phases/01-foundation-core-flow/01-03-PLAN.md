---
phase: 01-foundation-core-flow
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - challenge_tracker/lib/features/challenges/presentation/screens/home_screen.dart
  - challenge_tracker/lib/features/challenges/presentation/widgets/challenge_grid_item.dart
  - challenge_tracker/lib/features/challenges/presentation/widgets/progress_ring.dart
  - challenge_tracker/lib/features/challenges/presentation/widgets/empty_state_view.dart
  - challenge_tracker/lib/main.dart
autonomous: true

must_haves:
  truths:
    - "Home screen displays grid of active challenges"
    - "Each challenge tile shows name, progress ring, and streak count"
    - "Empty state prompts user to create first challenge"
    - "Tapping challenge tile navigates to detail (placeholder for now)"
    - "Loading state shows spinner while challenges load"
  artifacts:
    - path: "challenge_tracker/lib/features/challenges/presentation/screens/home_screen.dart"
      provides: "Main home screen with GridView"
      contains: "GridView.count"
    - path: "challenge_tracker/lib/features/challenges/presentation/widgets/challenge_grid_item.dart"
      provides: "Single challenge tile in grid"
      contains: "ProgressRing"
    - path: "challenge_tracker/lib/features/challenges/presentation/widgets/progress_ring.dart"
      provides: "Circular progress indicator"
      contains: "CircularPercentIndicator"
    - path: "challenge_tracker/lib/features/challenges/presentation/widgets/empty_state_view.dart"
      provides: "Empty state with CTA"
      contains: "onAddChallenge"
  key_links:
    - from: "home_screen.dart"
      to: "challengeListProvider"
      via: "ref.watch"
      pattern: "ref\\.watch\\(challengeListProvider\\)"
    - from: "challenge_grid_item.dart"
      to: "progress_ring.dart"
      via: "widget composition"
      pattern: "ProgressRing"
---

<objective>
Create the home screen UI with challenge grid, progress rings, and empty state.

Purpose: The home screen is the primary interface users see - showing all active challenges in a bold grid layout (Streaks-inspired) with progress visualization.
Output: HomeScreen with GridView, ChallengeGridItem tiles, ProgressRing widget, EmptyStateView.
</objective>

<execution_context>
@/Users/angelrodriguez/.claude/get-shit-done/workflows/execute-plan.md
@/Users/angelrodriguez/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-core-flow/01-RESEARCH.md
@.planning/phases/01-foundation-core-flow/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgressRing and EmptyStateView widgets</name>
  <files>
    challenge_tracker/lib/features/challenges/presentation/widgets/progress_ring.dart
    challenge_tracker/lib/features/challenges/presentation/widgets/empty_state_view.dart
  </files>
  <action>
1. Create directory: lib/features/challenges/presentation/widgets/

2. Create progress_ring.dart using percent_indicator (from RESEARCH.md Pattern 6 Option A):
```dart
import 'package:flutter/material.dart';
import 'package:percent_indicator/percent_indicator.dart';

class ProgressRing extends StatelessWidget {
  final double progress; // 0.0 to 1.0
  final double size;
  final Color? progressColor;
  final Color? backgroundColor;
  final String? centerText;
  final TextStyle? centerTextStyle;

  const ProgressRing({
    super.key,
    required this.progress,
    this.size = 100,
    this.progressColor,
    this.backgroundColor,
    this.centerText,
    this.centerTextStyle,
  });

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    final effectiveProgressColor = progressColor ?? theme.colorScheme.primary;
    final effectiveBackgroundColor = backgroundColor ?? theme.colorScheme.surfaceContainerHighest;

    return CircularPercentIndicator(
      radius: size / 2,
      lineWidth: size / 8,
      percent: progress.clamp(0.0, 1.0),
      center: centerText != null
          ? Text(
              centerText!,
              style: centerTextStyle ??
                  TextStyle(
                    fontSize: size / 4,
                    fontWeight: FontWeight.bold,
                    color: theme.colorScheme.onSurface,
                  ),
            )
          : null,
      progressColor: effectiveProgressColor,
      backgroundColor: effectiveBackgroundColor,
      circularStrokeCap: CircularStrokeCap.round,
      animation: true,
      animationDuration: 600,
    );
  }
}
```

3. Create empty_state_view.dart:
```dart
import 'package:flutter/material.dart';

class EmptyStateView extends StatelessWidget {
  final String title;
  final String subtitle;
  final String buttonText;
  final VoidCallback onAddChallenge;

  const EmptyStateView({
    super.key,
    this.title = 'No challenges yet',
    this.subtitle = 'Start your first 30-day challenge!',
    this.buttonText = 'Add Challenge',
    required this.onAddChallenge,
  });

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);

    return Center(
      child: Padding(
        padding: const EdgeInsets.all(32.0),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            // Icon
            Icon(
              Icons.emoji_events_outlined,
              size: 80,
              color: theme.colorScheme.primary.withOpacity(0.5),
            ),
            const SizedBox(height: 24),
            // Title
            Text(
              title,
              style: theme.textTheme.headlineSmall?.copyWith(
                fontWeight: FontWeight.bold,
              ),
              textAlign: TextAlign.center,
            ),
            const SizedBox(height: 8),
            // Subtitle
            Text(
              subtitle,
              style: theme.textTheme.bodyLarge?.copyWith(
                color: theme.colorScheme.onSurfaceVariant,
              ),
              textAlign: TextAlign.center,
            ),
            const SizedBox(height: 32),
            // CTA Button
            FilledButton.icon(
              onPressed: onAddChallenge,
              icon: const Icon(Icons.add),
              label: Text(buttonText),
              style: FilledButton.styleFrom(
                padding: const EdgeInsets.symmetric(
                  horizontal: 24,
                  vertical: 12,
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```
  </action>
  <verify>
Run: `cd challenge_tracker && flutter analyze lib/features/challenges/presentation/widgets/`
Expected: No errors
  </verify>
  <done>
- ProgressRing widget using CircularPercentIndicator with customizable size, colors, center text
- EmptyStateView with icon, title, subtitle, and "Add Challenge" button
- Both widgets use Material 3 theming
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ChallengeGridItem widget</name>
  <files>
    challenge_tracker/lib/features/challenges/presentation/widgets/challenge_grid_item.dart
  </files>
  <action>
1. Create challenge_grid_item.dart (from RESEARCH.md Pattern 5):
```dart
import 'package:flutter/material.dart';
import '../../data/models/challenge.dart';
import '../../data/models/challenge_pack.dart';
import '../../../../core/utils/streak_calculator.dart';
import 'progress_ring.dart';

class ChallengeGridItem extends StatelessWidget {
  final Challenge challenge;
  final VoidCallback onTap;

  const ChallengeGridItem({
    super.key,
    required this.challenge,
    required this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    final pack = ChallengePack.getById(challenge.packId);
    final isCompletedToday = StreakCalculator.isCompletedToday(
      challenge.completionDatesUtc,
    );
    final streak = StreakCalculator.calculateStreak(
      challenge.completionDatesUtc,
      challenge.startDateUtc,
    );

    return Card(
      elevation: 2,
      clipBehavior: Clip.antiAlias,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(16),
      ),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(16),
        child: Container(
          decoration: isCompletedToday
              ? BoxDecoration(
                  border: Border.all(
                    color: theme.colorScheme.primary,
                    width: 2,
                  ),
                  borderRadius: BorderRadius.circular(16),
                )
              : null,
          child: Padding(
            padding: const EdgeInsets.all(12),
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                // Pack emoji (top left indicator)
                if (pack != null)
                  Align(
                    alignment: Alignment.topLeft,
                    child: Text(
                      pack.emoji,
                      style: const TextStyle(fontSize: 20),
                    ),
                  ),
                const Spacer(),
                // Progress ring with day number
                ProgressRing(
                  progress: challenge.progress,
                  size: 70,
                  centerText: '${challenge.completedDays}',
                  progressColor: isCompletedToday
                      ? theme.colorScheme.primary
                      : theme.colorScheme.secondary,
                ),
                const SizedBox(height: 8),
                // Challenge name
                Text(
                  challenge.name,
                  style: theme.textTheme.titleSmall?.copyWith(
                    fontWeight: FontWeight.bold,
                  ),
                  textAlign: TextAlign.center,
                  maxLines: 2,
                  overflow: TextOverflow.ellipsis,
                ),
                const SizedBox(height: 4),
                // Streak indicator
                Row(
                  mainAxisAlignment: MainAxisAlignment.center,
                  mainAxisSize: MainAxisSize.min,
                  children: [
                    Icon(
                      isCompletedToday ? Icons.check_circle : Icons.local_fire_department,
                      size: 14,
                      color: isCompletedToday
                          ? theme.colorScheme.primary
                          : (streak > 0 ? Colors.orange : theme.colorScheme.outline),
                    ),
                    const SizedBox(width: 4),
                    Text(
                      isCompletedToday
                          ? 'Done today'
                          : '$streak day${streak == 1 ? '' : 's'}',
                      style: theme.textTheme.bodySmall?.copyWith(
                        color: theme.colorScheme.onSurfaceVariant,
                      ),
                    ),
                  ],
                ),
                const Spacer(),
              ],
            ),
          ),
        ),
      ),
    );
  }
}
```

KEY DESIGN DECISIONS:
- Square tiles (enforced by GridView childAspectRatio: 1.0)
- Completed today = primary color border + check icon
- Progress ring shows completed days in center
- Streak shown with fire icon (or check if done today)
- Pack emoji as visual identifier
  </action>
  <verify>
Run: `cd challenge_tracker && flutter analyze lib/features/challenges/presentation/widgets/challenge_grid_item.dart`
Expected: No errors
  </verify>
  <done>
- ChallengeGridItem shows: pack emoji, progress ring with day count, challenge name, streak
- Visual distinction for completed today (border + check icon)
- Uses StreakCalculator for streak and completion checks
- Responsive to tap with InkWell
  </done>
</task>

<task type="auto">
  <name>Task 3: Create HomeScreen with GridView and wire up main.dart</name>
  <files>
    challenge_tracker/lib/features/challenges/presentation/screens/home_screen.dart
    challenge_tracker/lib/main.dart
  </files>
  <action>
1. Create directory: lib/features/challenges/presentation/screens/

2. Create home_screen.dart (from RESEARCH.md UI Layer example):
```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../notifiers/challenge_list_notifier.dart';
import '../widgets/challenge_grid_item.dart';
import '../widgets/empty_state_view.dart';

class HomeScreen extends ConsumerWidget {
  const HomeScreen({super.key});

  void _navigateToAddChallenge(BuildContext context) {
    // TODO: Navigate to add challenge screen (Plan 04)
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(content: Text('Add Challenge - Coming soon')),
    );
  }

  void _navigateToChallengeDetail(BuildContext context, String challengeId) {
    // TODO: Navigate to challenge detail screen (Plan 05)
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('Challenge detail: $challengeId')),
    );
  }

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final challengesAsync = ref.watch(challengeListProvider);

    return Scaffold(
      appBar: AppBar(
        title: const Text('My Challenges'),
        centerTitle: true,
      ),
      body: challengesAsync.when(
        data: (challenges) {
          if (challenges.isEmpty) {
            return EmptyStateView(
              onAddChallenge: () => _navigateToAddChallenge(context),
            );
          }

          return RefreshIndicator(
            onRefresh: () => ref.read(challengeListProvider.notifier).refresh(),
            child: GridView.count(
              crossAxisCount: 2,
              childAspectRatio: 1.0, // Square tiles
              mainAxisSpacing: 12.0,
              crossAxisSpacing: 12.0,
              padding: const EdgeInsets.all(16.0),
              children: challenges.map((challenge) {
                return ChallengeGridItem(
                  challenge: challenge,
                  onTap: () => _navigateToChallengeDetail(context, challenge.id),
                );
              }).toList(),
            ),
          );
        },
        loading: () => const Center(
          child: CircularProgressIndicator(),
        ),
        error: (error, stack) => Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              const Icon(
                Icons.error_outline,
                size: 48,
                color: Colors.red,
              ),
              const SizedBox(height: 16),
              Text(
                'Failed to load challenges',
                style: Theme.of(context).textTheme.titleMedium,
              ),
              const SizedBox(height: 8),
              FilledButton.tonal(
                onPressed: () => ref.invalidate(challengeListProvider),
                child: const Text('Retry'),
              ),
            ],
          ),
        ),
      ),
      floatingActionButton: challengesAsync.maybeWhen(
        data: (challenges) => challenges.isNotEmpty
            ? FloatingActionButton(
                onPressed: () => _navigateToAddChallenge(context),
                child: const Icon(Icons.add),
              )
            : null,
        orElse: () => null,
      ),
    );
  }
}
```

3. Update main.dart to use HomeScreen:
```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:hive_flutter/hive_flutter.dart';
import 'package:timezone/data/latest.dart' as tz;
import 'features/challenges/data/services/hive_service.dart';
import 'features/challenges/presentation/screens/home_screen.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // Initialize Hive
  await Hive.initFlutter();

  // Initialize timezone database
  tz.initializeTimeZones();

  // Initialize HiveService (registers adapters)
  final hiveService = HiveService();
  await hiveService.init();

  runApp(
    const ProviderScope(
      child: ChallengeTrackerApp(),
    ),
  );
}

class ChallengeTrackerApp extends StatelessWidget {
  const ChallengeTrackerApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: '30-Day Challenge',
      debugShowCheckedModeBanner: false,
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(
          seedColor: Colors.blue,
          brightness: Brightness.light,
        ),
        useMaterial3: true,
      ),
      darkTheme: ThemeData(
        colorScheme: ColorScheme.fromSeed(
          seedColor: Colors.blue,
          brightness: Brightness.dark,
        ),
        useMaterial3: true,
      ),
      themeMode: ThemeMode.system,
      home: const HomeScreen(),
    );
  }
}
```

4. Verify app runs with empty state:
```bash
cd challenge_tracker && flutter run
```
  </action>
  <verify>
Run: `cd challenge_tracker && flutter analyze && flutter run -d macos 2>&1 | head -50` (or iOS simulator if available)
Expected: App launches showing empty state with "Add Challenge" button
  </verify>
  <done>
- HomeScreen watches challengeListProvider
- GridView.count with 2 columns and square tiles
- Empty state shown when no challenges
- Loading spinner during initial load
- Error state with retry button
- FAB shows when challenges exist
- Pull-to-refresh enabled
- App theme supports light/dark mode
  </done>
</task>

</tasks>

<verification>
1. `flutter analyze` - no errors
2. `flutter run` - app launches
3. Empty state view displays with icon, text, and "Add Challenge" button
4. FAB is hidden on empty state (only in empty view CTA)
5. Visual inspection: Material 3 theming applied correctly
</verification>

<success_criteria>
- HomeScreen displays GridView when challenges exist (tested with mock data or after Plan 04)
- EmptyStateView shown when no challenges
- ChallengeGridItem shows: progress ring, challenge name, streak count, pack emoji
- ProgressRing animates and shows day count in center
- Loading and error states handled properly
- Pull-to-refresh works
- FAB appears when challenges exist
- App runs without crashes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-flow/01-03-SUMMARY.md`
</output>
